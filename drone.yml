kind: pipeline
type: kubernetes
name: drone

steps:
  - name: build
    image: sankar31/baseimg:1.0
    commands:
      - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V
  - name : buildimage
    image: plugins/docker
    use_cache: true
    privileged: true
    settings:
      username: sankar31
      password: 123sinku
      repo: sankar31/droneex
      dockerfile: Dockerfile
      tags: 1.4
  - name : deploy
    image: sinlead/drone-kubectl
    settings:
      kubernetes_server:
        from_secret: k8s_server
      kubernetes_cert:
        from_secret: k8s_cert
      kubernetes_token:
        from_secret: k8s_token
    commands:
        - kubectl apply --validate=false -f droneex-k8.yaml
